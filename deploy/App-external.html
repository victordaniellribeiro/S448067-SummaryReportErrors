<!DOCTYPE html>
<html>
<head>
    <title>S448067-SummaryReportErrors</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Ext.form.field.Month",{extend:"Ext.form.field.Date",alias:"widget.monthfield",requires:["Ext.picker.Month"],alternateClassName:["Ext.form.MonthField","Ext.form.Month"],selectMonth:null,createPicker:function(){var t=this,e=Ext.String.format;return Ext.create("Ext.picker.Month",{pickerField:t,ownerCt:t.ownerCt,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,minDate:t.minValue,maxDate:t.maxValue,disabledDatesRE:t.disabledDatesRE,disabledDatesText:t.disabledDatesText,disabledDays:t.disabledDays,disabledDaysText:t.disabledDaysText,format:t.format,showToday:t.showToday,startDay:t.startDay,minText:e(t.minText,t.formatDate(t.minValue)),maxText:e(t.maxText,t.formatDate(t.maxValue)),listeners:{select:{scope:t,fn:t.onSelect},monthdblclick:{scope:t,fn:t.onOKClick},yeardblclick:{scope:t,fn:t.onOKClick},OkClick:{scope:t,fn:t.onOKClick},CancelClick:{scope:t,fn:t.onCancelClick}},keyNavConfig:{esc:function(){t.collapse()}}})},onCancelClick:function(){this.selectMonth=null,this.collapse()},onOKClick:function(){var t=this;t.selectMonth&&(t.setValue(t.selectMonth),t.fireEvent("select",t,t.selectMonth)),t.collapse()},onSelect:function(t,e){this.selectMonth=new Date(e[0]+1+"/1/"+e[1])}}),Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",_projectId:void 0,_releaseId:void 0,_releaseName:void 0,_releaseStartDate:void 0,_releaseEndDate:void 0,_initDate:void 0,_iterationId:void 0,_iterationName:void 0,_iterationStartDate:void 0,_iterationEndDate:void 0,_mapErrors:void 0,_exportData:void 0,_exportDataDetails:void 0,_exportButton:void 0,_exportButtonDetails:void 0,_includeInitiative:void 0,items:[{xtype:"container",itemId:"header",cls:"header"},{xtype:"container",itemId:"bodyContainer",width:"100%",autoScroll:!0},{xtype:"container",itemId:"detailsContainer",width:"100%",autoScroll:!0},{xtype:"container",itemId:"detailsContainerExport",width:"100%",autoScroll:!0}],launch:function(){var t=this.getContext().getProject().ObjectID;this._projectId=t,console.log("Project:",this._projectId);var e=Ext.create("Rally.ui.combobox.ReleaseComboBox",{fieldLabel:"Choose Release",width:400,itemId:"releasaeComboBox",allowClear:!0,showArrows:!1,scope:this,listeners:{ready:function(t){var e=t.getRecord();this._releaseStartDate=Rally.util.DateTime.toIsoString(e.get("ReleaseStartDate"),!0),this._releaseEndDate=Rally.util.DateTime.toIsoString(e.get("ReleaseDate"),!0),this._releaseId=e.get("ObjectID"),this._releaseName=t.getRecord().get("Name"),console.log(e)},select:function(t,e){var a=e[0];this._releaseStartDate=Rally.util.DateTime.toIsoString(a.get("ReleaseStartDate"),!0),this._releaseEndDate=Rally.util.DateTime.toIsoString(a.get("ReleaseDate"),!0),this._releaseId=a.get("ObjectID"),this._releaseName=t.getRecord().get("Name"),this._releaseDate=a.get("ReleaseDate")},scope:this}}),a=Ext.create("Rally.ui.combobox.IterationComboBox",{fieldLabel:"Choose Iteration",width:400,itemId:"iterationComboBox",allowClear:!0,showArrows:!1,scope:this,listeners:{ready:function(t){var e=t.getRecord();this._iterationStartDate=Rally.util.DateTime.toIsoString(e.get("StartDate"),!0),this._iterationEndDate=Rally.util.DateTime.toIsoString(e.get("EndDate"),!0),this._iterationId=e.get("ObjectID"),this._iterationName=e.get("Name")},select:function(t,e,a){var i=e[0];this._iterationStartDate=Rally.util.DateTime.toIsoString(i.get("StartDate"),!0),this._iterationEndDate=Rally.util.DateTime.toIsoString(i.get("EndDate"),!0),this._iterationId=i.get("ObjectID"),this._iterationName=i.get("Name")},scope:this}}),i=Ext.create("Ext.form.field.Month",{fieldLabel:"Choose month:",format:"F, Y",listeners:{select:function(t,e){console.log(this._initDate),this._initDate=e.toISOString()},scope:this}}),s=Ext.create("Rally.ui.Button",{text:"Search",margin:"10 10 10 100",scope:this,handler:function(){this._doSearch(this._projectId,this._initDate)}}),o=Ext.create("Rally.ui.CheckboxField",{id:"include",name:"include",fieldLabel:"Include Initiatives",padding:"0 10 0 0",inputValue:"i",listeners:{change:function(t,e,a){var i=e;this._includeInitiative=i},scope:this}});this._exportButton=Ext.create("Rally.ui.Button",{text:"Export",margin:"10 10 10 10",scope:this,handler:function(){var t=this._convertToCSV(this._exportData);console.log("converting to csv:",t);var e=document.createElement("a"),a=new Blob(["\ufeff",t]),i=URL.createObjectURL(a);e.href=i,e.download="report-errors.csv",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}),this._exportButtonDetails=Ext.create("Rally.ui.Button",{text:"Export",margin:"10 10 10 10",scope:this,handler:function(){var t=this._convertToCSV(this._exportDataDetails);console.log("converting to csv:",t);var e=document.createElement("a"),a=new Blob(["\ufeff",t]),i=URL.createObjectURL(a);e.href=i,e.download="report-errors.csv",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}),this.down("#detailsContainerExport").add(this._exportButtonDetails),this.myMask=new Ext.LoadMask({msg:"Please wait...",target:this}),this.down("#header").add([{xtype:"panel",autoWidth:!0,height:50,layout:"hbox",items:[{xtype:"radiogroup",fieldLabel:"Choose parameter",items:[{xtype:"radiofield",id:"radio1",name:"parameter",boxLabel:"Release",padding:"0 10 0 0",inputValue:"r"},{boxLabel:"Iteration",name:"parameter",padding:"0 10 0 0",inputValue:"i",id:"radio2"},{boxLabel:"By Month",width:80,name:"parameter",padding:"0 10 0 0",inputValue:"a",id:"radio3"}],listeners:{change:function(t,s,o){var n=s.parameter;this._searchParameter=n,"r"===n?(e.show(),a.hide(),i.hide()):"i"===n?(e.hide(),a.show(),i.hide()):"a"===n&&(e.hide(),a.hide(),i.show())},afterrender:function(){Ext.QuickTips.init(),Ext.QuickTips.register({target:"radio3",text:"Search for All option limited by 30 days",width:250,dismissDelay:2e3})},destroy:function(){Ext.QuickTips.destroy()},scope:this}}]},{xtype:"panel",items:[e,a,i,o,s,this._exportButton]}]),e.hide(),a.hide(),i.hide(),this._exportButton.hide(),this._exportButtonDetails.hide()},_doSearch:function(t,e){this.down("#bodyContainer").removeAll(!0),this.down("#detailsContainer").removeAll(!0),this.myMask.show();var a=this._loadStoriesAndFeatures();Deft.Promise.all(a).then({success:function(t){var e=this._loadData(t);this._generateGrid(e),this._exportButton.show()},failure:function(t){console.log("error:",t)},scope:this})},_loadStories:function(){console.log("loading stories:");var t=Ext.create("Deft.Deferred"),e=Ext.create("Rally.data.WsapiDataStore",{model:"HierarchicalRequirement",context:{project:"/project/"+this._projectId,projectScopeUp:!1,projectScopeDown:!0},fetch:["Name","FormattedID","ScheduleState","State","Project","AcceptedDate","c_ServiceLevelIdentifier","TestCases","Parent","PlannedEndDate","ActualEndDate","Release","ReleaseDate","CreationDate","Feature","PlanEstimate","TestCaseStatus","Iteration","EndDate","Requirement"],limit:1/0,sorters:[{property:"CreationDate",direction:"ASC"}]}),a=this._getFilter();return a&&e.addFilter(a),e.load().then({success:function(e){this.stories=e,t.resolve(e)},scope:this}),t.promise},_loadDefects:function(){console.log("loading defects:");var t=Ext.create("Deft.Deferred"),e=Ext.create("Rally.data.WsapiDataStore",{model:"Defect",context:{project:"/project/"+this._projectId,projectScopeUp:!1,projectScopeDown:!0},fetch:["Name","FormattedID","ScheduleState","State","Project","c_StrategyCategory","AcceptedDate","c_ServiceLevelIdentifier","PreliminaryEstimate","PreliminaryEstimateValue","TestCases","Parent","PlannedEndDate","ActualEndDate","PercentDoneByStoryCount","Release","ReleaseDate","CreationDate","Feature","PlanEstimate","TestCaseStatus","Iteration","EndDate","Requirement","Environment","c_RootCause","Milestones","Resolution"],limit:1/0,sorters:[{property:"CreationDate",direction:"ASC"}]}),a=this._getFilter();return a&&e.addFilter(a),e.load().then({success:function(e){this.defects=e,t.resolve(e)},scope:this}),t.promise},_loadFeatures:function(){console.log("loading features:");var t,e=Ext.create("Deft.Deferred"),a=Ext.create("Rally.data.WsapiDataStore",{model:"PortfolioItem/Feature",context:{project:"/project/"+this._projectId,projectScopeUp:!1,projectScopeDown:!0},fetch:["Name","FormattedID","ScheduleState","State","Project","c_StrategyCategory","AcceptedDate","c_ServiceLevelIdentifier","PreliminaryEstimate","PreliminaryEstimateValue","TestCases","Parent","PlannedEndDate","ActualEndDate","PercentDoneByStoryCount","Release","ReleaseDate","CreationDate","Feature","PlanEstimate","TestCaseStatus","Iteration","EndDate","Milestones"],limit:1/0,sorters:[{property:"CreationDate",direction:"ASC"}]});return(t="i"===this._searchParameter?this._getIterationFilterForFeatures():this._getFilter())&&a.addFilter(t),console.log("filter",t),a.load().then({success:function(t){this.features=t,e.resolve(t)},scope:this}),e.promise},_loadInitiatives:function(){console.log("loading initiatives:");var t=Ext.create("Deft.Deferred"),e=Ext.create("Rally.data.WsapiDataStore",{model:"PortfolioItem/Initiative",context:{project:"/project/"+this._projectId,projectScopeUp:!1,projectScopeDown:!0},fetch:["Name","FormattedID","ScheduleState","State","Project","c_StrategyCategory","AcceptedDate","c_ServiceLevelIdentifier","PreliminaryEstimate","PreliminaryEstimateValue","TestCases","Parent","PlannedEndDate","ActualEndDate","PercentDoneByStoryCount","Release","ReleaseDate","CreationDate","Feature","PlanEstimate","TestCaseStatus","Iteration","EndDate","Milestones"],limit:1/0,sorters:[{property:"CreationDate",direction:"ASC"}]}),a=this._getFilterInitiative();return a&&e.addFilter(a),e.load().then({success:function(e){this.initiatives=e,t.resolve(e)},error:function(t){console.log("error",t)},scope:this}),t.promise},_loadStoriesAndFeatures:function(){console.log("loading features and stories");var t=Ext.create("Deft.Deferred");return this._loadStories().then({success:function(){return this._loadDefects()},scope:this}).then({success:function(){return this._loadFeatures()},scope:this}).then({success:function(){var e,a=[];a=(a=(a=a.concat(this.stories)).concat(this.defects)).concat(this.features),this._includeInitiative?e=this._loadInitiatives():(e=Ext.create("Deft.Deferred")).resolve(),Deft.Promise.all([e]).then({success:function(e){if(console.log("all Records:",a),this._includeInitiative&&(a=a.concat(this.initiatives)),a&&a.length>0){var i=[];_.each(a,function(t){if("hierarchicalrequirement"===t.get("_type")){var e=t.get("TestCases"),a=e.Count;if(e&&a>0){var s=Ext.create("Deft.Deferred");i.push(s);var o=this._loadTestCases(t);Deft.Promise.all(o).then({success:function(e){t.get("TestCases").data=e,s.resolve()},failure:function(t){console.log("error:",t)},scope:this})}}},this),i&&i.length>0?Deft.Promise.all(i).then({success:function(){console.log("all stories loaded with TC"),t.resolve(a),this.myMask.hide()},failure:function(t){console.log("error:",t)},scope:this}):(t.resolve(a),this.myMask.hide())}else this.myMask.hide()},failure:function(t){console.log("error:",t)},scope:this})},scope:this}),t.promise},_getFilter:function(){var t;if("r"===this._searchParameter)t={property:"Release.Name",operator:"=",value:this._releaseName};else if("i"===this._searchParameter)t={property:"Iteration.Name",operator:"=",value:this._iterationName};else if("a"===this._searchParameter&&this._initDate){console.log("looking for all artifacts from:",this._initDate);var e=Ext.create("Rally.data.QueryFilter",{property:"CreationDate",operator:">",value:this._initDate}),a=new Date(new Date(this._initDate).getFullYear(),new Date(this._initDate).getMonth()+1,0);console.log("end date:",a.toISOString());var i=Ext.create("Rally.data.QueryFilter",{property:"CreationDate",operator:"<=",value:a.toISOString()});t=e.and(i)}return t},_getIterationFilterForFeatures:function(){initDate=this._iterationStartDate,endDate=this._iterationEndDate;var t=Ext.create("Rally.data.QueryFilter",{property:"CreationDate",operator:">",value:initDate}),e=Ext.create("Rally.data.QueryFilter",{property:"CreationDate",operator:"<=",value:endDate});return t.and(e)},_getFilterInitiative:function(){var t,e;if(!this._includeInitiative||"r"!==this._searchParameter&&"i"!==this._searchParameter)return this._getFilter();"r"===this._searchParameter&&(t=this._releaseStartDate,e=this._releaseEndDate),"i"===this._searchParameter&&(t=this._iterationStartDate,e=this._iterationEndDate);var a=Ext.create("Rally.data.QueryFilter",{property:"CreationDate",operator:">",value:t}),i=Ext.create("Rally.data.QueryFilter",{property:"CreationDate",operator:"<=",value:e});return a.and(i)},_generateGrid:function(t){var e=[],a=[],i=[],s=[];this._exportData=[],t.eachKey(function(t,o){this._includeInitiative?this._exportData.push({projectName:t,initiativemissingStrategy:o.initiativeStatistics.missingStrategy,initiativenotSizedCorrectly:o.initiativeStatistics.notSizedCorrectly,initiativemissingPlannedEndDate:o.initiativeStatistics.missingPlannedEndDate,initiativemissingActualEndDate:o.initiativeStatistics.missingActualEndDate,initiativepercentAndStateMismatch:o.initiativeStatistics.percentAndStateMismatch,featuremissingStrategy:o.featureStatistics.missingStrategy,featurenotSizedCorrectly:o.featureStatistics.notSizedCorrectly,featurenoParent:o.featureStatistics.noParent,featuremissingPlannedEndDate:o.featureStatistics.missingPlannedEndDate,featuremissingActualEndDate:o.featureStatistics.missingActualEndDate,featurepercentAndStateMismatch:o.featureStatistics.percentAndStateMismatch,featureoldReleaseNotDone:o.featureStatistics.oldReleaseNotDone,featurestateDoneButNoRelease:o.featureStatistics.stateDoneButNoRelease,featuremissingLevelIdentifier:o.featureStatistics.missingLevelIdentifier,storynotSizedCorrectly:o.storyStatistics.notSizedCorrectly,storynoParent:o.storyStatistics.noParent,storynoTestCases:o.storyStatistics.noTestCases,storyiterationButNoRelease:o.storyStatistics.iterationButNoRelease,storyreleaseButNoIteration:o.storyStatistics.releaseButNoIteration,storyoldIterationNotAccepted:o.storyStatistics.oldIterationNotAccepted,defectnoParent:o.defectStatistics.noParent,defectnotSizedCorrectly:o.defectStatistics.notSizedCorrectly,defectnoEnvironment:o.defectStatistics.noEnvironment,defectnoResolution:o.defectStatistics.noResolution,defectrootCause:o.defectStatistics.rootCause,defectnoMilestone:o.defectStatistics.noMilestone,defectoldIterationNotAccepted:o.defectStatistics.oldIterationNotAccepted,defectmismatchStateAndSchedule:o.defectStatistics.mismatchStateAndSchedule,defectmissingIteration:o.defectStatistics.missingIteration,defectiterationButNoRelease:o.defectStatistics.iterationButNoRelease}):this._exportData.push({projectName:t,featuremissingStrategy:o.featureStatistics.missingStrategy,featurenotSizedCorrectly:o.featureStatistics.notSizedCorrectly,featurenoParent:o.featureStatistics.noParent,featuremissingPlannedEndDate:o.featureStatistics.missingPlannedEndDate,featuremissingActualEndDate:o.featureStatistics.missingActualEndDate,featurepercentAndStateMismatch:o.featureStatistics.percentAndStateMismatch,featureoldReleaseNotDone:o.featureStatistics.oldReleaseNotDone,featurestateDoneButNoRelease:o.featureStatistics.stateDoneButNoRelease,featuremissingLevelIdentifier:o.featureStatistics.missingLevelIdentifier,storynotSizedCorrectly:o.storyStatistics.notSizedCorrectly,storynoParent:o.storyStatistics.noParent,storynoTestCases:o.storyStatistics.noTestCases,storyiterationButNoRelease:o.storyStatistics.iterationButNoRelease,storyreleaseButNoIteration:o.storyStatistics.releaseButNoIteration,storyoldIterationNotAccepted:o.storyStatistics.oldIterationNotAccepted,defectnoParent:o.defectStatistics.noParent,defectnotSizedCorrectly:o.defectStatistics.notSizedCorrectly,defectnoEnvironment:o.defectStatistics.noEnvironment,defectnoResolution:o.defectStatistics.noResolution,defectrootCause:o.defectStatistics.rootCause,defectnoMilestone:o.defectStatistics.noMilestone,defectoldIterationNotAccepted:o.defectStatistics.oldIterationNotAccepted,defectmismatchStateAndSchedule:o.defectStatistics.mismatchStateAndSchedule,defectmissingIteration:o.defectStatistics.missingIteration,defectiterationButNoRelease:o.defectStatistics.iterationButNoRelease}),e.push({projectName:t,missingStrategy:o.featureStatistics.missingStrategy,notSizedCorrectly:o.featureStatistics.notSizedCorrectly,noParent:o.featureStatistics.noParent,missingPlannedEndDate:o.featureStatistics.missingPlannedEndDate,missingActualEndDate:o.featureStatistics.missingActualEndDate,percentAndStateMismatch:o.featureStatistics.percentAndStateMismatch,oldReleaseNotDone:o.featureStatistics.oldReleaseNotDone,stateDoneButNoRelease:o.featureStatistics.stateDoneButNoRelease,missingLevelIdentifier:o.featureStatistics.missingLevelIdentifier}),this._includeInitiative&&a.push({projectName:t,missingStrategy:o.initiativeStatistics.missingStrategy,notSizedCorrectly:o.initiativeStatistics.notSizedCorrectly,missingPlannedEndDate:o.initiativeStatistics.missingPlannedEndDate,missingActualEndDate:o.initiativeStatistics.missingActualEndDate,percentAndStateMismatch:o.initiativeStatistics.percentAndStateMismatch}),i.push({projectName:t,notSizedCorrectly:o.storyStatistics.notSizedCorrectly,noParent:o.storyStatistics.noParent,noTestCases:o.storyStatistics.noTestCases,iterationButNoRelease:o.storyStatistics.iterationButNoRelease,releaseButNoIteration:o.storyStatistics.releaseButNoIteration,oldIterationNotAccepted:o.storyStatistics.oldIterationNotAccepted}),s.push({projectName:t,noParent:o.defectStatistics.noParent,notSizedCorrectly:o.defectStatistics.notSizedCorrectly,noEnvironment:o.defectStatistics.noEnvironment,noResolution:o.defectStatistics.noResolution,rootCause:o.defectStatistics.rootCause,noMilestone:o.defectStatistics.noMilestone,oldIterationNotAccepted:o.defectStatistics.oldIterationNotAccepted,mismatchStateAndSchedule:o.defectStatistics.mismatchStateAndSchedule,missingIteration:o.defectStatistics.missingIteration,iterationButNoRelease:o.defectStatistics.iterationButNoRelease})},this);var o,n=Ext.create("Ext.data.JsonStore",{fields:["projectName","missingStrategy","notSizedCorrectly","noParent","missingPlannedEndDate","missingActualEndDate","percentAndStateMismatch","oldReleaseNotDone","stateDoneButNoRelease","missingLevelIdentifier"],data:e}),r=Ext.create("Ext.data.JsonStore",{fields:["projectName","missingStrategy","notSizedCorrectly","noParent","missingPlannedEndDate","missingActualEndDate","percentAndStateMismatch"],data:a}),c=Ext.create("Ext.data.JsonStore",{fields:["projectName","notSizedCorrectly","noParent","noTestCases","iterationButNoRelease","releaseButNoIteration","oldIterationNotAccepted"],data:i}),l=Ext.create("Ext.data.JsonStore",{fields:["projectName","noParent","notSizedCorrectly","noResolution","noEnvironment","rootCause","noMilestone","oldIterationNotAccepted","mismatchStateAndSchedule","missingIteration","iterationButNoRelease"],data:s}),d=Ext.create("Ext.grid.Panel",{width:500,itemId:"featuresGrid",cls:"grid-header-project",store:n,viewConfig:{enableTextSelection:!0},listeners:{cellclick:function(t,e,a,i){var s=i.get("projectName");_.each(_.uniq(e.className.split(" ")),function(t){if(t.startsWith("custom")){var e=t.split(/[-]/)[1],a=t.split(/[-]/)[2];this._showDetailsGrid(this._mapErrors[s][e][a])}},this)},scope:this},columns:[{dataIndex:"projectName",flex:3},{text:"Missing Strategy",dataIndex:"missingStrategy",flex:1,tdCls:"custom-features-missingStrategy"},{text:"Not Sized Correctly",dataIndex:"notSizedCorrectly",flex:1,tdCls:"custom-features-notSizedCorrectly"},{text:"No Parent",dataIndex:"noParent",flex:1,tdCls:"custom-features-noParent"},{text:"Missing Planned End Date",dataIndex:"missingPlannedEndDate",flex:1,tdCls:"custom-features-missingPlannedEndDate"},{text:"Missing Actual End Date",dataIndex:"missingActualEndDate",flex:1,tdCls:"custom-features-missingActualEndDate"},{text:"% & State Mismatched",dataIndex:"percentAndStateMismatch",flex:1,tdCls:"custom-features-percentAndStateMismatch"},{text:"Old release not done",dataIndex:"oldReleaseNotDone",flex:1,tdCls:"custom-features-oldReleaseNotDone"},{text:"Comp. miss Release",dataIndex:"stateDoneButNoRelease",flex:1,tdCls:"custom-features-stateDoneButNoRelease"},{text:"Missing Level Identifier",dataIndex:"missingLevelIdentifier",flex:1,tdCls:"custom-features-missingLevelIdentifier"}]});this._includeInitiative&&(o=Ext.create("Ext.grid.Panel",{width:450,itemId:"initiativesGrid",cls:"grid-header-project",store:r,viewConfig:{enableTextSelection:!0},listeners:{cellclick:function(t,e,a,i){var s=i.get("projectName");_.each(_.uniq(e.className.split(" ")),function(t){if(t.startsWith("custom")){var e=t.split(/[-]/)[1],a=t.split(/[-]/)[2];this._showDetailsGrid(this._mapErrors[s][e][a])}},this)},scope:this},columns:[{dataIndex:"projectName",flex:3},{text:"Missing Strategy",dataIndex:"missingStrategy",flex:1,tdCls:"custom-initiatives-missingStrategy"},{text:"Not Sized Correctly",dataIndex:"notSizedCorrectly",flex:1,tdCls:"custom-initiatives-notSizedCorrectly"},{text:"Missing Planned End Date",dataIndex:"missingPlannedEndDate",flex:1,tdCls:"custom-initiatives-missingPlannedEndDate"},{text:"Missing Actual End Date",dataIndex:"missingActualEndDate",flex:1,tdCls:"custom-initiatives-missingActualEndDate"},{text:"% & State Mismatched",dataIndex:"percentAndStateMismatch",flex:1,tdCls:"custom-initiatives-percentAndStateMismatch"}]}));var u,m=Ext.create("Ext.grid.Panel",{width:450,itemId:"storiesGrid",cls:"grid-header-project",store:c,viewConfig:{enableTextSelection:!0},listeners:{cellclick:function(t,e,a,i,s,o,n){var r=i.get("projectName");_.each(_.uniq(e.className.split(" ")),function(t){if(t.startsWith("custom")){var e=t.split(/[-]/)[1],a=t.split(/[-]/)[2];this._showDetailsGrid(this._mapErrors[r][e][a])}},this)},scope:this},columns:[{dataIndex:"projectName",flex:3},{text:"No Parent",dataIndex:"noParent",tdCls:"custom-stories-noParent",flex:2},{text:"Not Sized Correctly",dataIndex:"notSizedCorrectly",tdCls:"custom-stories-notSizedCorrectly",flex:2},{text:"Story No Test Case",dataIndex:"noTestCases",tdCls:"custom-stories-noTestCases",flex:2},{text:"Iteration No Release",dataIndex:"iterationButNoRelease",tdCls:"custom-stories-iterationButNoRelease",flex:2},{text:"Release No iteration",dataIndex:"releaseButNoIteration",tdCls:"custom-stories-releaseButNoIteration",flex:2},{text:"Old iteration Not Accpeted",dataIndex:"oldIterationNotAccepted",tdCls:"custom-stories-oldIterationNotAccepted",flex:2}]}),h=Ext.create("Ext.grid.Panel",{width:600,itemId:"defectsGrid",cls:"grid-header-project",store:l,viewConfig:{enableTextSelection:!0},listeners:{cellclick:function(t,e,a,i){var s=i.get("projectName");_.each(_.uniq(e.className.split(" ")),function(t){if(t.startsWith("custom")){var e=t.split(/[-]/)[1],a=t.split(/[-]/)[2];this._showDetailsGrid(this._mapErrors[s][e][a])}},this)},scope:this},columns:[{dataIndex:"projectName",flex:3},{text:"No Parent",dataIndex:"noParent",tdCls:"custom-defects-noParent",flex:2},{text:"Not Sized Correctly",dataIndex:"notSizedCorrectly",tdCls:"custom-defects-notSizedCorrectly",flex:2},{text:"No Environment",dataIndex:"noEnvironment",tdCls:"custom-defects-noEnvironment",flex:2},{text:"No Resolution",dataIndex:"noResolution",tdCls:"custom-defects-noResolution",flex:2},{text:"No Root Cause",dataIndex:"rootCause",tdCls:"custom-defects-rootCause",flex:2},{text:"No Milestone",dataIndex:"noMilestone",tdCls:"custom-defects-noMilestone",flex:2},{text:"Old Iteration not Accepted",dataIndex:"oldIterationNotAccepted",tdCls:"custom-defects-oldIterationNotAccepted",flex:2},{text:"Mismatch State Schedule State",dataIndex:"mismatchStateAndSchedule",tdCls:"custom-defects-mismatchStateAndSchedule",flex:2},{text:"Missing Iteration",dataIndex:"missingIteration",tdCls:"custom-defects-missingIteration",flex:2},{text:"Iteration But No Release",dataIndex:"iterationButNoRelease",tdCls:"custom-defects-iterationButNoRelease",flex:2}]}),f=Ext.create("Ext.panel.Panel",{width:500,title:"Features Statistics",autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[d]});this._includeInitiative&&(u=Ext.create("Ext.panel.Panel",{width:450,title:"Initiatives Statistics",autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[o]}));var p=Ext.create("Ext.panel.Panel",{width:450,title:"Story Statistics",autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[m]}),g=Ext.create("Ext.panel.Panel",{width:680,title:"Defect Statistics",autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[h]}),S=Ext.create("Ext.panel.Panel",{autoScroll:!0,layout:{type:"hbox",align:"stretch",padding:5},padding:5,items:[u,f,p,g]});this.down("#bodyContainer").add(S)},_showDetailsGrid:function(t){if(this.down("#detailsContainer").removeAll(!0),t&&t.length>0){var e=[];this._exportDataDetails=[],_.each(t,function(t){var a,i,s=t.get("ObjectID"),o=t.get("State"),n=t.get("Release"),r=t.get("Iteration");"portfolioitem/feature"===t.get("_type")?(a="/portfolioitem/feature/",i=t.get("Parent")?t.get("Parent").FormattedID+" - "+t.get("Parent").Name:"",o=o?o.Name:""):"hierarchicalrequirement"===t.get("_type")?(a="/userstory/",i=t.get("Feature")?t.get("Feature").FormattedID+" - "+t.get("Feature").Name:""):"defect"===t.get("_type")?(a="/defect/",i=t.get("Requirement")?t.get("Requirement").FormattedID+" - "+t.get("Requirement").Name:""):"portfolioitem/initiative"===t.get("_type")&&(a="/portfolioitem/initiative/",i=t.get("Parent")?t.get("Parent").FormattedID+" - "+t.get("Parent").Name:"",o=o?o.Name:""),e.push({_ref:a+s,Name:t.get("Name"),CreationDate:t.get("CreationDate"),FormattedID:t.get("FormattedID"),State:o,ScheduleState:t.get("ScheduleState"),Iteration:r?r.Name:"",Release:n?n.Name:"",Parent:i,PreliminaryEstimate:t.get("PreliminaryEstimate")}),this._exportDataDetails.push({id:t.get("FormattedID"),Name:t.get("Name"),CreationDate:t.get("CreationDate"),FormattedID:t.get("FormattedID"),State:o,ScheduleState:t.get("ScheduleState"),Iteration:r?r.Name:"",Release:n?n.Name:"",Parent:i,PreliminaryEstimate:t.get("PreliminaryEstimateValue")})},this);var a=Ext.create("Rally.data.custom.Store",{data:e,pageSize:1e3}),i=Ext.create("Rally.ui.grid.Grid",{showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,itemId:"detailsGrid",id:"detailsGrid",store:a,columnCfgs:[{xtype:"templatecolumn",text:"ID",dataIndex:"FormattedID",tdCls:"x-change-cell",tpl:Ext.create("Rally.ui.renderer.template.FormattedIDTemplate")},{text:"Name",dataIndex:"Name",flex:2},{text:"Parent",dataIndex:"Parent",flex:1},{text:"Iteration",dataIndex:"Iteration"},{text:"Release",dataIndex:"Release"},{text:"State",dataIndex:"State"},{text:"Schedule State",dataIndex:"ScheduleState"},{text:"Creation Date",dataIndex:"CreationDate",xtype:"datecolumn",format:"m/d/Y"}]}),s=Ext.create("Ext.panel.Panel",{autoScroll:!0,padding:5,layout:{type:"vbox",align:"stretch"},items:[i]});this.down("#detailsContainer").add(s),this._exportButtonDetails.show()}},_loadData:function(t){var e=new Ext.util.MixedCollection;return this._mapErrors={},_.each(t,function(t){var a,i=t.get("Project").Name;e.containsKey(i)?(a=e.get(i)).artifacts.push(t):((a={name:i,artifacts:[]}).artifacts.push(t),e.add(i,a))},this),e.add("Total",{name:"Total",artifacts:t}),console.log("all projects:",e),e.eachKey(function(t,e){var a={projectName:t,features:{missingStrategy:[],notSizedCorrectly:[],noParent:[],missingPlannedEndDate:[],missingActualEndDate:[],percentAndStateMismatch:[],oldReleaseNotDone:[],stateDoneButNoRelease:[],missingLevelIdentifier:[]},initiatives:{missingStrategy:[],notSizedCorrectly:[],missingPlannedEndDate:[],missingActualEndDate:[],percentAndStateMismatch:[]},stories:{noParent:[],notSizedCorrectly:[],noTestCases:[],iterationButNoRelease:[],releaseButNoIteration:[],oldIterationNotAccepted:[]},defects:{oldIterationNotAccepted:[],noParent:[],notSizedCorrectly:[],noEnvironment:[],noResolution:[],rootCause:[],noMilestone:[],mismatchStateAndSchedule:[],missingIteration:[],iterationButNoRelease:[]}};this._mapErrors[t]=a},this),e.eachKey(function(t,e){e.featureStatistics=this._loadFeatureStatistics(e,e.artifacts),this._includeInitiative&&(e.initiativeStatistics=this._loadInitiativeStatistics(e,e.artifacts)),e.storyStatistics=this._loadStoryStatistics(e,e.artifacts),e.defectStatistics=this._loadDefectStatistics(e,e.artifacts)},this),e},_loadFeatureStatistics:function(t,e){var a=t.name;console.log("extracting statistics for features of project:",a);var i={missingStrategy:0,notSizedCorrectly:0,noParent:0,missingPlannedEndDate:0,missingActualEndDate:0,percentAndStateMismatch:0,oldReleaseNotDone:0,stateDoneButNoRelease:0,missingLevelIdentifier:0};return _.each(e,function(t){if("portfolioitem/feature"===t.get("_type")){var e=t.get("PercentDoneByStoryCount"),s=null;t.get("State")&&(s=t.get("State").Name);var o=null;t.get("Release")&&(o=new Date(t.get("Release").ReleaseDate));var n=null;t.get("PreliminaryEstimate")&&(n=t.get("PreliminaryEstimate").Name),t.get("c_StrategyCategory")||(i.missingStrategy+=1,this._mapErrors[a].features.missingStrategy.push(t)),n&&-1!==["XS","S","M","L","XL"].indexOf(n)||(i.notSizedCorrectly+=1,this._mapErrors[a].features.notSizedCorrectly.push(t)),t.get("Parent")||(i.noParent+=1,this._mapErrors[a].features.noParent.push(t)),t.get("PlannedEndDate")||(i.missingPlannedEndDate+=1,this._mapErrors[a].features.missingPlannedEndDate.push(t)),t.get("ActualEndDate")||"Staging"!==s&&"Done"!==s||(console.log(t,t.get("ActualEndDate")),i.missingActualEndDate+=1,this._mapErrors[a].features.missingActualEndDate.push(t)),(e>0&&e<1&&"In-Progress"!==s||1===e&&"Done"!==s&&"Staging"!==s||0===e&&"Elaborating"!==s&&"Exploring"!==s&&null!==s)&&(i.percentAndStateMismatch+=1,this._mapErrors[a].features.percentAndStateMismatch.push(t));var r=new Date;o&&o<r&&"Done"!==s&&"Staging"!==s&&(i.oldReleaseNotDone+=1,this._mapErrors[a].features.oldReleaseNotDone.push(t)),t.get("Release")||"Done"!==s&&"Staging"!==s||(i.stateDoneButNoRelease+=1,this._mapErrors[a].features.stateDoneButNoRelease.push(t));var c=t.get("c_ServiceLevelIdentifier");o&&o>new Date("2018-11-15T00:00:00.000Z")&&!c&&(i.missingLevelIdentifier+=1,this._mapErrors[a].features.missingLevelIdentifier.push(t))}},this),i},_loadInitiativeStatistics:function(t,e){var a=t.name;console.log("extracting statistics for initiatives of project:",a);var i={missingStrategy:0,notSizedCorrectly:0,missingPlannedEndDate:0,missingActualEndDate:0,percentAndStateMismatch:0};return _.each(e,function(t){if("portfolioitem/initiative"===t.get("_type")){var e=t.get("PercentDoneByStoryCount"),s=null;t.get("State")&&(s=t.get("State").Name);t.get("Release")&&new Date(t.get("Release").ReleaseDate);var o=null;t.get("PreliminaryEstimate")&&(o=t.get("PreliminaryEstimate").Name),t.get("c_StrategyCategory")||(i.missingStrategy+=1,this._mapErrors[a].initiatives.missingStrategy.push(t)),o&&-1!==["XS","S","M","L","XL"].indexOf(o)||(i.notSizedCorrectly+=1,this._mapErrors[a].initiatives.notSizedCorrectly.push(t)),t.get("PlannedEndDate")||(i.missingPlannedEndDate+=1,this._mapErrors[a].initiatives.missingPlannedEndDate.push(t)),t.get("ActualEndDate")||"Staging"!==s&&"Done"!==s||(console.log(t,t.get("ActualEndDate")),i.missingActualEndDate+=1,this._mapErrors[a].initiatives.missingActualEndDate.push(t)),(e>0&&e<1&&"In-Progress"!==s||1===e&&"Done"!==s&&"Staging"!==s||0===e&&"Elaborating"!==s&&"Exploring"!==s&&null!==s)&&(i.percentAndStateMismatch+=1,this._mapErrors[a].initiatives.percentAndStateMismatch.push(t))}},this),i},_loadStoryStatistics:function(t,e){var a=t.name;console.log("extracting statistics for stories of project:",a);var i={noParent:0,notSizedCorrectly:0,noTestCases:0,iterationButNoRelease:0,releaseButNoIteration:0,oldIterationNotAccepted:0};return _.each(e,function(t){if("hierarchicalrequirement"===t.get("_type")){var e=t.get("Feature"),s=t.get("PlanEstimate"),o=t.get("CreationDate"),n=t.get("AcceptedDate"),r=t.get("ScheduleState"),c=null;if(t.get("Iteration")&&(c=new Date(t.get("Iteration").EndDate)),!e&&o>new Date("2017-08-13T00:00:00.000Z")&&(i.noParent+=1,this._mapErrors[a].stories.noParent.push(t)),-1===[0,1,2,3,5,8].indexOf(s)&&o>new Date("2017-08-13T00:00:00.000Z")&&(i.notSizedCorrectly+=1,this._mapErrors[a].stories.notSizedCorrectly.push(t)),n>=new Date("2019-01-01T00:00:00.000Z")){var l=t.get("TestCases"),d=l.Count;if(l&&0!==d){if(l&&d>0&&t.get("TestCases").data){for(var u=t.get("TestCases").data,m=!1,h=0;h<u.length&&!m;){"Acceptance Criteria"===u[h].get("Type")&&(m=!0),h++}m||(i.noTestCases+=1,this._mapErrors[a].stories.noTestCases.push(t))}}else i.noTestCases+=1,this._mapErrors[a].stories.noTestCases.push(t)}!t.get("Release")&&t.get("Iteration")&&o>new Date("2017-08-13T00:00:00.000Z")&&(i.iterationButNoRelease+=1,this._mapErrors[a].stories.iterationButNoRelease.push(t)),t.get("Release")&&!t.get("Iteration")&&o>new Date("2017-08-13T00:00:00.000Z")&&(i.releaseButNoIteration+=1,this._mapErrors[a].stories.releaseButNoIteration.push(t));var f=new Date;t.get("Iteration")&&"Accepted"!==r&&"Ready to Ship"!==r&&c<f&&o>new Date("2017-08-13T00:00:00.000Z")&&(i.oldIterationNotAccepted+=1,this._mapErrors[a].stories.oldIterationNotAccepted.push(t))}},this),i},_loadDefectStatistics:function(t,e){var a=t.name;console.log("extracting statistics for defects of project:",a);var i={oldIterationNotAccepted:0,noParent:0,notSizedCorrectly:0,noEnvironment:0,noResolution:0,rootCause:0,noMilestone:0,mismatchStateAndSchedule:0,missingIteration:0,iterationButNoRelease:0};return _.each(e,function(t){if("defect"===t.get("_type")){var e=t.get("CreationDate"),s=t.get("PlanEstimate"),o=t.get("ScheduleState"),n=t.get("Resolution"),r=t.get("Iteration"),c=t.get("Release"),l=t.get("State"),d=t.get("Environment"),u=new Date;if(r){var m=new Date(r.EndDate);"Accepted"!==o&&"Ready to Ship"!==o&&m<u&&e>new Date("2017-08-13T00:00:00.000Z")&&(i.oldIterationNotAccepted+=1,this._mapErrors[a].defects.oldIterationNotAccepted.push(t))}if(!t.get("Requirement")&&e>new Date("2017-08-13T00:00:00.000Z")&&(i.noParent+=1,this._mapErrors[a].defects.noParent.push(t)),-1===[0,1,2,3,5,8].indexOf(s)&&e>new Date("2017-08-13T00:00:00.000Z")&&(i.notSizedCorrectly+=1,this._mapErrors[a].defects.notSizedCorrectly.push(t)),(!d||"None"===d)&&e>new Date("2017-08-13T00:00:00.000Z")&&(i.noEnvironment+=1,this._mapErrors[a].defects.noEnvironment.push(t)),"Accepted"!==o&&"Ready to Ship"!==o||n&&"None"!==n||!(e>new Date("2017-08-13T00:00:00.000Z"))||(i.noResolution+=1,this._mapErrors[a].defects.noResolution.push(t)),("Accepted"===o||"Ready to Ship"===o)&&0===t.get("c_RootCause").Count)if("a"===this._searchParameter){var h=this._initDate;e>new Date(h)&&(i.rootCause+=1,this._mapErrors[a].defects.rootCause.push(t))}else i.rootCause+=1,this._mapErrors[a].defects.rootCause.push(t);0!==t.get("Milestones").Count||"Accepted"!==o&&"Ready to Ship"!==o||"Closed"!==l||"Code Change"!==n&&"Configuration Change"!==n&&"Database Change"!==n&&"Deployment Issue"!==n||!(e>new Date("2017-08-13T00:00:00.000Z"))||(this._mapErrors[a].defects.noMilestone.push(t),i.noMilestone+=1),(("Accepted"===o||"Ready to Ship"===o)&&"Closed"!==l&&"Cancel"!==l||"Accepted"!==o&&"Ready to Ship"!==o&&"Closed"===l&&e>new Date("2017-08-13T00:00:00.000Z"))&&(this._mapErrors[a].defects.mismatchStateAndSchedule.push(t),i.mismatchStateAndSchedule+=1),"Unelaborated"!==o&&!r&&e>new Date("2017-08-13T00:00:00.000Z")&&(this._mapErrors[a].defects.missingIteration.push(t),i.missingIteration+=1),!c&&r&&e>new Date("2017-08-13T00:00:00.000Z")&&(this._mapErrors[a].defects.iterationButNoRelease.push(t),i.iterationButNoRelease+=1)}},this),i},_loadTestCases:function(t){var e=Ext.create("Deft.Deferred");return t.getCollection("TestCases").load({fetch:["Type"],callback:function(t,a,i){e.resolve(t)}}),e.promise},_convertToCSV:function(t){var e=Object.keys(t[0]),a=function(t,e){return null===e?"":e},i=t.map(function(t){return e.map(function(e){return JSON.stringify(t[e],a)}).join(",")});return i.unshift(e.join(",")),i.join("\r\n")}});

            Rally.launchApp('CustomApp', {
                name:"S448067-SummaryReportErrors",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        .grid-header-project .x-box-inner{width:140px;height:145px !important}.grid-header-project .x-box-target{height:145px !important}.grid-header-project .x-column-header{height:145px !important}.grid-header-project .x-column-header-inner{height:145px !important}.grid-header-project .x-column-header-text{-webkit-transform:rotate(-90deg);-moz-transform:rotate(-90deg);-o-transform:rotate(-90deg);-ms-transform:rotate(-90deg);transform:rotate(-90deg);display:inline-flex;text-align:left;font-weight:bold;border-left-color:#fff;width:40px !important;height:25px !important;position:relative;margin-top:100px}.x-ie8 .grid-header-project .x-column-header-text{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);position:absolute;left:25px;bottom:20px}
    </style>
</head>
<body>
</body>
</html>
